<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebRTC Chat App</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/simple-web-rtc@latest/dist/simple-web-rtc.min.js"></script>
    <script src="/dist/bundle.js"></script>
</head>
<body>
    <h1>WebRTC Chat App</h1>
    <input type="text" id="username" placeholder="Username">
    <select id="roomSelect"></select>
    <br><br>
    <textarea id="messageInput"></textarea>
    <button onclick="joinRoom()">Join Room</button>
    <button onclick="sendMessage()">Send Message</button>

    <div id="videoContainer"></div>
    <div id="audioContainer"></div>

    <script>
        const socket = io('http://localhost:5000');
        const username = document.getElementById('username');
        const roomSelect = document.getElementById('roomSelect');
        const messageInput = document.getElementById('messageInput');

        let webrtc;
        let localStream;
        let remoteStreams = {};

        async function joinRoom() {
            const roomName = roomSelect.value;
            const connectionId = socket.id;
            await webrtc.joinRoom(roomName, connectionId);
            await socket.emit('joinRoom', roomName, connectionId);
        }

        async function sendMessage() {
            const message = messageInput.value;
            await socket.emit('sendMessage', roomSelect.value, message);
            messageInput.value = '';
        }

        webrtc = new SimpleWebRTC({
            localVideoEl: 'localVideo',
            remoteVideosEl: 'remoteVideos',
            autoRequestMedia: true
        });

        webrtc.on('readyToCall', () => {
            console.log('WeRTC is ready to call');
        });

        webrtc.on('videoAdded', (event) => {
            console.log('video added event', event);
        });

        webrtc.on('videoRemoved', (event) => {
            console.log('video removed event', event);
        });

        socket.on('connect', () => {
            console.log('Socket connected');
        });

        socket.on('disconnect', () => {
            console.log('Socket disconnected');
        });

        socket.on('receiveMessage', (connectionId, message) => {
            console.log('Received message:', message);
            // Add received message to UI
        });
    </script>
</body>
